CC= gcc 
CFLAGS=  $(INCDIR) -Wall -Werror -pedantic -ggdb3 -fPIC -DPIC -z execstack -D_REENTRANT -fstack-protector 
#CC = clang 
#CFLAGS=  $(INCDIR) -Wall -Werror -pedantic -ggdb3 -fPIC -DPIC -D_REENTRANT -fstack-protector 
INCDIR = -I. -I../toolset_gc/include/
#SYSLIBS = ../toolset_gc/lib/libgc.a -lm -luuid -lpthread 
SYSLIBS = -lm -luuid 
RANLIB= ranlib
AR = ar
ARFLAGS = cr

OBJS1 = maccess.o maflush.o mamake.o madelete.o maadd.o \
	mamemory.o mashmlock.o log.o
LIB1 =  maccess.a 

all: $(LIB1) e_load e_print e_rebuild  e1_load e1_print e1_rebuild \
	example_shmrm example1_shmrm btree_parameters 

# targets
$(LIB1): $(OBJS1)
	 $(AR) $(ARFLAGS) $@ $(OBJS1)
	 $(RANLIB) $@

btree_parameters: btree_parameters.o 
	   $(CC) $(CFLAGS) $(TCAP) btree_parameters.o  \
		   $(SYSLIBS) -o btree_parameters

btree_parameters.o: btree_parameters.c 
	   $(CC) $(CFLAGS) -c btree_parameters.c


e_load:    e_load.o 
	   $(CC) $(CFLAGS) $(TCAP) e_load.o log.o $(LIB1) $(SYSLIBS) -o e_load

e_load.o:  e_load.c
	   $(CC) $(CFLAGS) -c e_load.c

e_print:    e_print.o 
	   $(CC) $(CFLAGS) $(TCAP) e_print.o log.o $(LIB1) $(SYSLIBS) -o e_print

e_print.o:  e_print.c
	   $(CC) $(CFLAGS) -c e_print.c

e_rebuild: e_rebuild.o 
	   $(CC) $(CFLAGS) $(TCAP) e_rebuild.o log.o $(LIB1) $(SYSLIBS) \
		   -o e_rebuild

e_reubild.o:  e_rebuild.c
	   $(CC) $(CFLAGS) -c e_rebuild.c

e1_load:   e1_load.o 
	   $(CC) $(CFLAGS) $(TCAP) e1_load.o log.o $(LIB1) $(SYSLIBS) -o e1_load

e1_load.o: e1_load.c
	   $(CC) $(CFLAGS) -c e1_load.c

e1_print:  e1_print.o 
	   $(CC) $(CFLAGS) $(TCAP) e1_print.o log.o $(LIB1) $(SYSLIBS) -o e1_print

e1_rebuild.o: e1_rebuild.c
	   $(CC) $(CFLAGS) -c e1_rebuild.c

e1_rebuild:  e1_rebuild.o 
	   $(CC) $(CFLAGS) $(TCAP) e1_rebuild.o log.o $(LIB1) $(SYSLIBS) \
		   -o e1_rebuild

e1_print.o: e1_print.c
	   $(CC) $(CFLAGS) -c e1_print.c

example_shmrm: example_shmrm.o 
	   $(CC) $(CFLAGS) $(TCAP) example_shmrm.o $(LIB1) $(SYSLIBS) \
           -o example_shmrm

example_shmrm.o: example_shmrm.c
	   $(CC) $(CFLAGS) -c example_shmrm.c

example1_shmrm: example1_shmrm.o 
	   $(CC) $(CFLAGS) $(TCAP) example1_shmrm.o $(LIB1) $(SYSLIBS) \
           -o example1_shmrm

example1_shmrm.o: example1_shmrm.c
	   $(CC) $(CFLAGS) -c example1_shmrm.c

clean:      
	./example_shmrm; ./example1_shmrm; rm -f core core.* *.o *.dbc *.cdx \
		*.log *.tmp $(LIB1) $(LIB2) $(LIB3) example e_load e_print \
		e_rebuild  example1 e1_load  e1_print e1_rebuild calculate \
		key example_shmrm example1_shmrm btree_parameters
cleandata: 
	rm -rf *.dbc *.cdx; ./example_shmrm; ./example1_shmrm
